---
import Container from "./commons/container.astro";
import { defaultLang, getI18N } from "../i18n/utils";
import { Label } from "@/components/starwind/label";
import { Input } from "@/components/starwind/input";
import { RadioGroup, RadioGroupItem } from "@/components/starwind/radio-group";
import { Textarea } from "@/components/starwind/textarea";
import arrow from "../assets/arrow.svg?raw";
const t = getI18N(defaultLang);
---

<main class='flex flex-col w-screen relative pt-32 pb-24' id='contact'>
   <div class='relative flex flex-col justify-center gap-16'>
      <h1
         class='leading-none text-center font-extrabold italic tracking-normal md:tracking-[-4px]'
         style='font-size: clamp(3.5rem, 15vw, 15rem);'
         data-i18n='contact.title'
         data-animate='slide-up'
      >
         {t.contact.title}
      </h1>
      <Container>
         <form
            id='contact-form'
            class='flex flex-col gap-10 max-w-[62rem] mx-auto'
            data-msg-sending={t.contact.form.sending}
            data-msg-success={t.contact.form.success}
            data-msg-error={t.contact.form.error}
         >
            <div class='flex flex-col gap-2' data-animate='slide-up'>
               <Label for='name' data-i18n='contact.form.name'
                  >{t.contact.form.name}</Label
               >
               <Input
                  id='name'
                  size='lg'
                  name='name'
                  placeholder='John Doe'
                  required
               />
            </div>
            <div class='flex flex-col gap-2' data-animate='slide-up'>
               <Label for='location' data-i18n='contact.form.location'
                  >{t.contact.form.location}</Label
               >
               <Input
                  id='location'
                  size='lg'
                  name='location'
                  placeholder='Australia'
               />
            </div>
            <div class='flex flex-col gap-2' data-animate='slide-up'>
               <Label for='email'>Email</Label>
               <Input
                  id='email'
                  size='lg'
                  name='email'
                  type='email'
                  placeholder='john.doe@example.com'
                  required
               />
            </div>
            <RadioGroup
               name='type'
               defaultValue='creator'
               legend='Choose an option'
               orientation='horizontal'
               class='gap-10'
               data-animate='slide-up'
            >
               <div class='flex gap-2 items-center'>
                  <RadioGroupItem id='creator' value='creator' name='type' />
                  <Label for='creator' data-i18n='contact.form.creator'
                     >{t.contact.form.creator}</Label
                  >
               </div>
               <div class='flex gap-2 items-center'>
                  <RadioGroupItem id='brand' value='brand' name='type' />
                  <Label for='brand' data-i18n='contact.form.brand'
                     >{t.contact.form.brand}</Label
                  >
               </div>
            </RadioGroup>
            <div class='flex flex-col gap-2' data-animate='slide-up'>
               <Label for='message' data-i18n='contact.form.message'
                  >{t.contact.form.message}</Label
               >
               <Textarea
                  id='message'
                  size='lg'
                  name='message'
                  placeholder={t.contact.form.messagePlaceholder}
                  data-i18n-placeholder='contact.form.messagePlaceholder'
                  required
               />
            </div>

            <button
               type='submit'
               id='submit-btn'
               class='group self-center border-foreground border px-6 py-3 rounded-full font-medium text-foreground flex items-center gap-4 transition-all duration-300 ease-out hover:bg-foreground hover:text-background disabled:opacity-50 disabled:cursor-not-allowed'
               style='font-size: clamp(1.5rem, 2.8vw, 2.5rem);'
               data-animate='slide-up'
            >
               <span id='submit-text' data-i18n='contact.form.submit'
                  >{t.contact.form.submit}</span
               >
               <span
                  class='arrow-icon h-[1em] w-[1em] transition-all duration-300 ease-out group-hover:-translate-y-1 group-hover:rotate-12'
                  set:html={arrow}
               />
            </button>
            <div
               id='form-message'
               class='text-center font-medium min-h-[1rem] transition-opacity duration-300 opacity-0'
            >
            </div>
         </form>
      </Container>
   </div>
</main>

<script>
   const form = document.getElementById("contact-form") as HTMLFormElement;
   const submitBtn = document.getElementById("submit-btn") as HTMLButtonElement;
   const submitText = document.getElementById("submit-text") as HTMLSpanElement;
   const formMessage = document.getElementById(
      "form-message"
   ) as HTMLDivElement;

   const messages = {
      sending: form.dataset.msgSending || "Sending...",
      success: form.dataset.msgSuccess || "Message sent successfully!",
      error: form.dataset.msgError || "Something went wrong. Please try again.",
   };

   const originalButtonText = submitText.textContent || "Send";

   form.addEventListener("submit", async (e) => {
      e.preventDefault();

      formMessage.style.opacity = "0";
      submitBtn.disabled = true;
      submitText.textContent = messages.sending;

      const formData = new FormData(form);

      try {
         const response = await fetch("/sendEmail.php", {
            method: "POST",
            body: formData,
         });

         const data = await response.json();

         if (data.success) {
            formMessage.textContent = messages.success;
            formMessage.classList.add("text-green-600");
            formMessage.classList.remove("text-red-600");
            form.reset();
         } else {
            formMessage.textContent = messages.error;
            formMessage.classList.add("text-red-600");
            formMessage.classList.remove("text-green-600");
         }

         formMessage.style.opacity = "1";
      } catch (error) {
         formMessage.textContent = messages.error;
         formMessage.classList.add("text-red-600");
         formMessage.classList.remove("text-green-600");
         formMessage.style.opacity = "1";
      } finally {
         submitBtn.disabled = false;
         submitText.textContent = originalButtonText;

         setTimeout(() => {
            formMessage.style.opacity = "0";
         }, 5000);
      }
   });
</script>

<style>
   .arrow-icon {
      transform: scaleY(-1);
      filter: invert(1);
   }

   .group:hover .arrow-icon {
      filter: invert(0);
   }
</style>
